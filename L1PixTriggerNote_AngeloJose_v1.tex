%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% This is our AN about L1 Pixel Trigger %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%
\documentclass[a4paper,12pt,oneside]{article}
%%% Escrever em Português
%%%%%%%%%%%%
\usepackage[brazil]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
%%% Usando referencias para footnotes
\usepackage{footmisc}
%%% Cores para os footnotes
%\usepackage{xcolor}
\usepackage[usenames,dvipsnames]{xcolor}
%%% Cores em tabelas
\usepackage{color, colortbl}

%%% Escolha das fontes
%%% Combo: Palatino + Helvetica + Courier, com EulerVM para matemática
\usepackage{mathpazo}
\usepackage[scaled=.95]{helvet}
\usepackage{courier}
\linespread{1.05} %%% Palatino needs more spacing.
%%% Geometria da página. Sugiro manter estas mesmas margens e 15 cm de espaço de texto.
%\usepackage[a4paper,pdftex,top=2.8cm,bottom=4cm,left=3.4cm,right=2.6cm]{geometry}
%\textwidth=15.0 true cm

% Hide subsubsections
%\setcounter{secnumdepth}{2}
%\setcounter{tocdepth}{2}

\usepackage{sprace}
\usepackage{multirow} % allowing to merge rows in table
% Use isto pros headers
\usepackage{fancyhdr}
%\setlength{\headheight}{15.2pt}
%\pagestyle{fancy}
%\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter.\ #1}{}}
%% E menos espaço ao começar o capítulo
\usepackage{titlesec}

%%%%%% Pacote para rotacao de tabelas, textos e figuras
\usepackage{rotating}

\titleformat{\chapter}[display]
  {\normalfont\rmfamily\huge\mdseries}
  {\chaptertitlename\ \thechapter}{20pt}{\huge}
\titlespacing*{\chapter}{0pt}{-20pt}{40pt}
% Linha Extra
\newcommand{\linha}{\enlargethispage{1\baselineskip}}
% Páginas bonitas
\fancypagestyle{plain}{%
\fancyhf{} % clear all header and footer fields
\fancyfoot[C]{\textit \thepage} % except the center
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}}
\fancypagestyle{fancyplain}{%
\fancyhf{}
\fancyhead[L]{\textit{\leftmark}}
\fancyhead[R]{\textit{\thepage}}
%%%%%\fancyfoot[C]{\today} % Use este fancyfoot pros drafts (data no pé da página)!
\fancyfoot[C]{} % Use este fancyfoot (vazio) pra versão final!
\renewcommand{\headrulewidth}{0.6pt}
\renewcommand{\footrulewidth}{0pt}}

%%%%%%%%%%%% Colorindo footnot marks %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand\thefootnote{\textcolor{blue}{\arabic{footnote}}}

%%%%%%%%%%%% Colorindo tabelas %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newcommand{\Ab}{\cellcolor{blue}\phantom{x}}
%\newcommand{\Ag}{\cellcolor{gray}\phantom{x}}
%\newcommand{\Av}{\cellcolor{green}\phantom{x}}
%\newcommand{\Ar}{\cellcolor{red}\phantom{x}}
%\newcommand{\Aw}{\cellcolor{white}\phantom{x}}
%\newcommand{\Ab}{\multirow{2}{*}{x}}
%\newcommand{\Ag}{\multirow{2}{*}{x}}
%\newcommand{\Av}{\multirow{2}{*}{x}}
%\newcommand{\Ar}{\multirow{2}{*}{x}}
%\newcommand{\Aw}{}
%\newcommand{\Ab}{\multirow{2}{*}{\cellcolor{blue}\phantom{x}}}
%\newcommand{\Ag}{\multirow{2}{*}{\cellcolor{gray}\phantom{x}}}
%\newcommand{\Av}{\multirow{2}{*}{\cellcolor{green}\phantom{x}}}
%\newcommand{\Ar}{\multirow{2}{*}{\cellcolor{red}\phantom{x}}}
%\newcommand{\Aw}{}
\newcommand{\Ab}{\multirow{2}{*}{\bf \color{Black}{\#}}}
\newcommand{\Ag}{\multirow{2}{*}{\bf \color{Orange}{\#}}}
\newcommand{\Av}{\multirow{2}{*}{\bf \color{Cyan}{\#}}}
\newcommand{\Ar}{\multirow{2}{*}{\bf \color{red}{\#}}}
\newcommand{\Ap}{\multirow{2}{*}{\bf \color{PineGreen}{\#}}}
\newcommand{\Aw}{}


%%%%%%%%%%%% Comandos para facilitar a vida %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\pt}{\ensuremath{p_{_T}}}
\newcommand{\ptone}{\ensuremath{p_{T1}}\hspace{0.1cm}}
\newcommand{\pttwo}{\ensuremath{p_{T2}}\hspace{0.1cm}}
\newcommand{\muOne}{\ensuremath{\mu_{1}}\hspace{0.1cm}}
\newcommand{\muTwo}{\ensuremath{\mu_{2}}\hspace{0.1cm}}
\newcommand{\dzero}{D\O}
\newcommand{\DZERO}{\dzero}
\renewcommand{\trigger}{{\it trigger}}
\newcommand{\triggers}{{\it triggers}}
\newcommand{\nicefrac}[2]{\raise.5ex\hbox{\footnotesize #1}\kern-.15em/\kern-.15em\lower.25ex\hbox{\footnotesize #2}}
%\hypersetup{pdftitle={Procura de Sinais de Dimensões Extras Universais em Colisões Próton-Antipróton},
%            pdfauthor={Angelo de Souza Santos},
%            pdfsubject={High Energy Physics},
%            pdfkeywords={High Energy Physics}
%            			{Particle Physics}
%            			{Hadron Colliders} 
%				{Extra Dimensions}
%				{Beyond the Standard Model},
%			colorlinks=true,
%			citecolor=blue,
%			linkcolor=blue			
%            }
%\begin{document}
%%% This makes all the frontmatter stuff, sans the Table of Contents.
%\pagestyle{plain}
%\include{Preambulo}
%%%% The Table of Contents and a new page
%\tableofcontents
%\newpage
%\pagestyle{fancyplain}
%%\pagestyle{headings}
%\pagenumbering{arabic}
%\include{introducao}
%\include{modelo_padrao}
%\include{dimensoes_extras}
%\include{detector}
%\include{aquisicao_de_dados_e_simulacao}
%\include{amostras_de_Dados_e_MC}
%\include{pre_selecao}
%\include{background_multijatos}
%\include{distribuicoes_cinematicas}
%\include{incertezas_sistematicas_e_limites}
%\include{conclusao}
%\appendix
%%% Truque
%\renewcommand{\chaptername}%
%    {Apêndice}
%\include{apendice_estimativa_QCD}
%\include{apendice_incerteza_sistematica_QCD}
%\include{apendice_incerteza_sistematica_trigger}
%\include{apendice_metodo_muon_smearing}
%\bibliography{tesebib}{}
%\bibliographystyle{lucas_unsrt}
%\end{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\documentclass[a4paper,oneside,12pt]{article}

%\usepackage{amsmath}
%\usepackage{polyglossia}
%\usepackage{unicode-math}
%\usepackage{graphicx}

%%% PORTUGUES
%\setdefaultlanguage{brazil}
%\setotherlanguage{english}
%\gappto\captionsbrazil{\renewcommand{\abstractname}{Resumo}}
%\gappto\captionsbrazil{\renewcommand{\contentsname}{Índice}}

%%% FONTES
%\usepackage{fontspec}
%\setmainfont[Ligatures=TeX]{TeX Gyre Pagella}
%%\setmainfont[Ligatures=TeX]{Linux Libertine O}
%\setmathfont{Cambria Math}

%%% LAYOUT
\usepackage{indentfirst}
\usepackage[a4paper,pdftex,top=2.8cm,bottom=4cm,left=3.5cm,right=1.5cm]{geometry}
\usepackage{setspace}
%%\singlespacing
\onehalfspacing

%%% TABELAS
%\usepackage[table]{xcolor}
%\usepackage{tabularx}

%\newcommand{\Vz}{\cellcolor[gray]{1.0}\phantom{xx}}
%\newcommand{\LS}{\cellcolor{red!25}\phantom{xx}}
%\newcommand{\ST}{\cellcolor{blue!25}\phantom{xx}}
%\newcommand{\MT}{\cellcolor[gray]{0.75}\phantom{xx}}
%\newcommand{\LT}{\cellcolor{green!65!black}\phantom{xx}}
%\newcommand{\alien}{\textit}
%\newcommand{\sprace}{\textsc{sprace}}
%\newcommand{\exodiboson}{\textsc{\mbox{EXODiBoson}}}
%\newcommand{\sprace}{\mbox{SPRACE}}
%\newcommand{\exodiboson}{\mbox{EXODIBOSON}}
\newcommand{\exodiboson} {\textsc{exodiboson}\xspace}
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}

%%% REFERÊNCIAS
\usepackage{hyperref}

%\hypersetup{pdftitle={Angelo\_de\_Souza\_Santos-Projeto\_Post-Doc},
%            pdfauthor={Angelo de Souza Santos},
%			colorlinks=true,
%			citecolor=blue,
%			linkcolor=black,
%			urlcolor=blue			
%          }
           
\begin{document}

%\begin{titlepage}

%\begin{center}

% Upper part of the page
%\includegraphics[width=0.25\textwidth]{logoUNESP.pdf}\\[1cm]    

%~
%\vskip 2 cm
%{\huge Projeto de Pós-Doutorado}\\[0.5cm]


% Title
%\HRule \\
%{\huge \bfseries Busca por Nova Física no Detector\\[0.3cm]
%CMS do LHC}\\[0.3cm]

%\HRule \\[3cm]


% Author and supervisor
%\begin{flushright} \large
%Dr.~Angelo de Souza Santos
%\vskip 1 cm
%\emph{Supervisor:} \\
%Dr.~Pedro Galli Mercadante
%\end{flushright}

%\end{center}

%\end{titlepage}
%~
%\vskip 2 cm

%\begin{abstract}
%Este projeto apresenta ...
%\end{abstract}

%\vskip 2 cm

%\begin{english}
%\begin{abstract}
%\begin{center}
%{\bf Abstract}
%\end{center}
%This project presents ....
%\end{abstract}
%\end{english}

%\pagebreak

%\tableofcontents

%\pagebreak

\section{Performance Studies Based on Phase 1 Pixel Detector}

        \subsection{The L1PixelTrigger Analyzer}
        An EDAnalyzer is a module in the \texttt{CMSSW} framework that allows to extract information from datasets containing simulated or collision data. The extracted information is usually saved in files browsable by ROOT, and organized in a TTree structure. In our particular case, the TTree was called \textit{NtupleMaker} and it contais several branches documented below.

Previous analyzers were useful guidelines to build the \textit{L1PixelTrigger}, between them are the \textit{PixelTree} provided by the Tracker Detector Performance Group (DPG), and the \textit{TrackTriggerStudy} provided by the Track Trigger Integration (TTI) group. 

                   \subsubsection{Code and Documentation}

      %             \begin{itemize}
       %            \item Information about what is the code
       %            \item how it has been created,
        %           \item its location
         %          \item and contents.
         %          \end{itemize}

                   The \textit{L1PixelTrigger} analyzer was developed in \texttt{CMSSW\_6\_1\_2\_SLHC6\_patch1}, with the routine {\it mkedanlzr L1PixelTrigger}. The source code, named {\it L1PixelTrigger.cc}, is available at 
{\it https://github.com/jruizvar/pixel-analysis/}. 

The collections retrieved by the analyzer are:

                   \begin{itemize}
                   \item \textbf{\textit{PileupSummaryInfo}}: Provides the number of interaction per bunch crossing. This collection stores sixteen bunch crossings (12 early, one in-time, three late). To retrieve the pileup distribution, we have to loop into the collection and use the method
 \texttt{getPU\_NumInteractions()} for each bunch. The associated branch in the ROOT file is called  {\it pileup}.
                   \item \textbf{\textit{BeamSpot}}: Provides the position and error of the beam spot.  The associated branches are
                     {\it beamSpotX0}, {\it beamSpotX0Error}, {\it beamSpotY0}, {\it beamSpotY0Error}, {\it beamSpotZ0}, and
                     {\it beamSpotZ0Error}. This collection also provides details about the beam. The width and error in the
                     transverse plane are given by {\it beamWidthX}, {\it beamWidthXError}, {\it beamWidthY}, and
                     {\it beamWidthYError}. The spread and error along the Z direction is given by {\it beamSigmaZ}, and {\it beamSigmaZError}.
                   \item \textbf{\textit{GenParticleCollection}}: Provides information of the event at the generator level. The
                     multiplicity of \textit{GenParticles} corresponds to the size of the collection, and is stored in the branch
                     {\it genPartN}. Relevant information is stored in the branches {\it genPartEt}, {\it genPartPt},
                     {\it genPartEta}, {\it genPartPhi}, {\it genPartCharge}, and {\it genPartId}. The \textit{GenParticleCollection}
                     does not include the underlying particles in samples with pileup. 
                   \item \textbf{\textit{L1EmParticleCollection}}: Provides information of the event as measured by the electromagnetic
                     calorimeter. The size of the collection is stored in the branch {\it egN}.
                     Relevant information is stored in the branches {\it egE, egEt, egEta, egPhi}, and \textit{egCharge}. The method
                     \texttt{getCalorimeterPosition()} taken from the \textit{TrackTriggerStudy} analyzer, is used to translate from cylindrical to cartesian coordinates. The output
                     of this method is stored in the branches {\it egGx, egGy, egGz} and corresponds to the global position in the calorimeter.
                   \item \textbf{\textit{SiPixelRecHitCollection}}: Provides information of the event as measured by the pixel detector.
                    The multiplicity of reconstructed hits in the barrel is store in the
                     branch {\it bHitN}. The global position is stored in the branches {\it bHitGx, bHitGy, bHitGz}. Relevant
                     branches associated with the pixel barrel are {\it bHitLayer, bHitLadder, bHitModule}. 
                     The cluster size is stored in the branch {\it bClSize} . \newline
                     \noindent The multiplicity of reconstructed hits in the endcap is store in the branch {\it fHitN}. The global position is stored in the
                     branches {\it fHitGx, fHitGy, fHitGz}. Relevant branches associated with the pixel endcap are
                     {\it fHitDisk, fHitBlade, fHitModule}. The cluster size is stored in the branch {\it fClSize}. 
                   \end{itemize}


                   \subsubsection{Simulation Tools}

%                   \begin{itemize}
%                   \item What samples have been created
%                   \item and tools used for that.
%                   \end{itemize}
                   
                   Before starting the production of the TTree structure, based on the \textit{L1PixelTrigger} analyzer as described
                   above, there are two mandatory steps.
                   \begin{itemize}
                     \item A sample of electron-gun is produced in a first step. Here, one electron per event is produced in generator
                       level together with the {\it GenParticles} collection, and the deposities of energy in the detector components
                       are simulated by Geant4.
                     \item Using the electron-gun samples as input, the second step takes place, where the deposities of energy are
                       transleted into detector signal, and digital signals are converted into a {\texttt{RAW}} format. This is the
                       same format provide by the online system.
                   \end{itemize}

                   A offical electron-gun sample, with $E_{T}$ between 2 and 50 GeV, is used as input to the second step. Here the
                   pile up is added to the electron-gun sample. In order to simulate a scenario of 140 pile up, a total of 140
                   minimum bias are summed to. Table~\ref{tab:gen-sim-minbias} lists the official electron and minimum bias samples.

                   \begin{table}[!htb]
                   \centering
                   \scriptsize
                     \caption{Official MC samples (\texttt{GEN-SIM} for electron-gun and Minimum Bias) used to create
                       \texttt{DIGI-RAW} and \texttt{Ntuple} files.}
                     \label{tab:gen-sim-minbias}
                     \begin{tabular}{lcl}
\hline
{\bf Description} & {\bf Number of Events} & {\bf Official Samples} \\ \hline \hline
GEN-SIM           & 50K                    & /SingleElectronFlatPt0p2To50/UpgFall13-POSTLS261\_V2-v1/GEN-SIM \\ \hline
Minimum Bias      & 30M                    & /MinBias\_TuneZ2star\_14TeV-pythia6/UpgFall13-POSTLS261\_V2-v1/GEN-SIM \\ \hline
                     \end{tabular}
                   \end{table}

                   Output files of the second step have a \texttt{DIGI-RAW} format. Such samples are produced using configuration
                   files created with a \texttt{CMSSW} tool called {\it cmsDriver}. Table~\ref{tab:digi-raw} provides a list of
                   {\it datasetpath} for \texttt{CRAB} corresponding to the \texttt{DIGI-RAW} files in four different pile up
                   scenarios: 0, 35, 70 and 140 pile up. Since outputs are big files --- a total size range from 12 to 400 GB ---
                   they are produced via \texttt{CRAB}. These files are located at T2\_SPRACE site and each sample of pile up
                   contains 50 K events.

                   \begin{table}[!htb]
                     \centering
                     \scriptsize
                     \caption{\texttt{DIGI-RAW} MC samples created from official electron-gun and Minimum Bias MC samples.
                       \texttt{CRAB} {\it datasetpaths} are provided for 0, 35, 70 and 140 pile up from top to bottom lines.
                       Each sample has 50K events.}
                     \label{tab:digi-raw}
                     \begin{tabular}{c}
\hline
%{\bf Format}                                        & {\bf Pile up}  & {\bf Size (GB)}      & {\bf Data Set Paths} \\ \hline \hline
%\multirow{4}{*}{\begin{turn}{90}DIGI-RAW\end{turn}} & 0              & 12                   & /SingleElectronFlatPt0p2To50/adesouza-SingleElectron\_noPileUP\_50K\_DIGI\_RAW\_v6-a49c986a608faae0f4ff11329e2bb83f/USER                         \\
%                                                    & 35             & 110                  & /SingleElectronFlatPt0p2To50/adesouza-SingleElectron\_PU35\_50K\_DIGI\_RAW\_v6-61196276663e836a1b830c8b84a619d4/USER                         \\
%                                                    & 70             & 210                  & /SingleElectronFlatPt0p2To50/adesouza-SingleElectron\_PU70\_50K\_DIGI\_RAW\_v6-3752475e524a60330e4a83a2952b3625/USER                         \\
%                                                    & 140            & 400                  & /SingleElectronFlatPt0p2To50/adesouza-SingleElectron\_PU140\_50K\_DIGI\_RAW\_v6-f74d2f3945f4866a2ea25695b38d79f0/USER                         \\ \hline
%\multirow{4}{*}{\begin{turn}{90}Ntuples\end{turn}}  & 0              & 0.024                & /pnfs/sprace.org.br/data/cms/store/user/adesouza/SingleElectronFlatPt0p2To50/MergedNtuples/SingleElectron\_Pt2to50\_noPU\_ntuple.root                         \\
%                                                    & 35             & 5.6                  & /pnfs/sprace.org.br/data/cms/store/user/adesouza/SingleElectronFlatPt0p2To50/MergedNtuples/SingleElectron\_Pt2to50\_PU35\_ntuple\_50K.root                         \\
%                                                    & 70             & 11                   & /pnfs/sprace.org.br/data/cms/store/user/adesouza/SingleElectronFlatPt0p2To50/MergedNtuples/SingleElectron\_Pt2to50\_PU70\_ntuple\_50K.root                         \\
%                                                    & 140            & 22                   & /pnfs/sprace.org.br/data/cms/store/user/adesouza/SingleElectronFlatPt0p2To50/MergedNtuples/SingleElectron\_Pt2to50\_PU140\_ntuple\_50K.root                         \\ \hline
{\bf Data Set Paths} \\ \hline \hline
/SingleElectronFlatPt0p2To50/adesouza-SingleElectron\_noPileUP\_50K\_DIGI\_RAW\_v6-a49c986a608faae0f4ff11329e2bb83f/USER                         \\
/SingleElectronFlatPt0p2To50/adesouza-SingleElectron\_PU35\_50K\_DIGI\_RAW\_v6-61196276663e836a1b830c8b84a619d4/USER                         \\
/SingleElectronFlatPt0p2To50/adesouza-SingleElectron\_PU70\_50K\_DIGI\_RAW\_v6-3752475e524a60330e4a83a2952b3625/USER                         \\
/SingleElectronFlatPt0p2To50/adesouza-SingleElectron\_PU140\_50K\_DIGI\_RAW\_v6-f74d2f3945f4866a2ea25695b38d79f0/USER                         \\ \hline
                     \end{tabular}
                   \end{table}

                   Production of the TTree structure goes in a third step with the full event reconstruction, where the
                   \texttt{DIGI-RAW} samples are taken as input into configuration files also created via {\it cmsDriver}.
                   Four different samples, corresponding to each pile up scenario, are produced via \texttt{CRAB}. They are
                   located in T2\_SPRACE with sizes varying from 24 MB to 22 GB. This is the file path to them:

                   {\footnotesize /pnfs/sprace.org.br/data/cms/store/user/adesouza/SingleElectronFlatPt0p2To50/MergedNtuples/}.

                   
                   \begin{figure}[!htb]
                     \centering
%                     \includegraphics[scale=1.0]{}
                     \caption{RZ view of reconstructed hits in the pixel detector.}
                     \label{}
                   \end{figure}
                   
                   \begin{figure}[!htb]
                     \centering
%                     \includegraphics[scale=1.0]{}
                     \caption{Pile up distributions in four different scenarios: zero (top left), 35 (top right), 70 (bottom
                       left) and 140 (bottom right) pile up.}
                     \label{}
                   \end{figure}
                   
                   \begin{table}[!htb]
                     \centering
                     \caption{Beam spot position and associated uncertainty.}
                     \label{}
                     \begin{tabular}{ccc}
                     \end{tabular}
                   \end{table}

        \subsection{Results on Phase 1 Pixel Detector Performances}

        \begin{itemize}
          \item Results based on CMSSW\_6 with emphasis on the effect of increasing luminosity
          \item and different pixel cluster algorithms.
        \end{itemize}

        \begin{figure}[!htb]
          \centering
%          \includegraphics[scale=1.0]{}
          \caption{$E_{T}$, $\eta$ and $\phi$ distributions of generated particles (using single electron-gun).}
          \label{}
        \end{figure}

        \begin{figure}[!htb]
          \centering
%          \includegraphics[scale=1.0]{}
          \caption{$E_{T}$, $\eta$ and $\phi$ distributions of L1EM particles (using single electron-gun) for 0 pile up.}
          \label{}
        \end{figure}

        \begin{figure}[!htb]
          \centering
%          \includegraphics[scale=1.0]{}
          \caption{$E_{T}$, $\eta$ and $\phi$ distributions of L1EM particles (using single electron-gun) for 35 pile up.}
          \label{}
        \end{figure}

        \begin{figure}[!htb]
          \centering
%          \includegraphics[scale=1.0]{}
          \caption{$E_{T}$, $\eta$ and $\phi$ distributions of L1EM particles (using single electron-gun) for 70 pile up.}
          \label{}
        \end{figure}

        \begin{figure}[!htb]
          \centering
%          \includegraphics[scale=1.0]{}
          \caption{$E_{T}$, $\eta$ and $\phi$ distributions of L1EM particles (using single electron-gun) for 140 pile up.}
          \label{}
        \end{figure}

        \begin{figure}[!htb]
          \centering
          \includegraphics[scale=0.7]{Number_of_pixel_clusters.pdf}
          \caption{Number of pixel clusters per event in the different components of the pixel detector left by a single electron.
            Forward $(z>0)$ and backward $(z<0)$ disks are taken separately.}
%          \caption{Pixel clusters and ocuppancies for different pile up scenarios.}
          \label{}
        \end{figure}


%\bibliography{Bibliography}{}
%\bibliographystyle{lucas_unsrt}
\end{document}
